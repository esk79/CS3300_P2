<html>
<head>
<!-- Load the d3 library. -->
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<style>
	body { font-family: "Futura"; } div { margin: 30px; }
    svg { background-color: #f0f0f0; }
    .fullBar { fill: #ccc; }
    .premiseBar { fill:rgb(255,165,0); }
    .axis path { fill: none; stroke: #aaa; }
    .axis line { stroke: #aaa; }
    .axis text { fill: #aaa; font-size: .7em; }
    .point {fill: rgba(200,0,255,.4);}
    .selectedPoint {fill: rgba(200,255,0,.6);}
    .pointLabel {display:none;}
    .selectedLabel {display:block; font-size:.7em;}

</style>
</head>
<body>

	<div id = "graph">
		<form id = "selectData">
			X-Value: 
			<select id = "xValue" name = "xValue">
				<option value = "1" selected = "selected">Option 1</option>
				<option value = "2">Option 2</option>
				<option value = "3">Option 3</option>
			</select>
			<br>
			Y-Value:
			<select id = "yValue" name = "yValue">
				<option value = "1">Option 1</option>
				<option value = "2" selected = "selected">Option 2</option>
				<option value = "3">Option 3</option>
			</select>
			<br>
			<button type = "button" onclick = "scatterPlot(testData,xValue.value,yValue.value); return false;">
                Update Data</button>
		</form>


	</div>

	<script>
	var scatterHeight = 400;
	var scatterWidth = 600;
	var scatterPadding = 75;
    var selectedPoints = [];

	var testData = [["Point 1",1,1,1],["Point 2",2,2,2],["Point 3",3,3,5],["Point 4",4,5,20],["Point 5",5,3,4],["Point 6",10,2,29],["Point 7",8,10,3],["Point 8",3,7,5],["Point 9",1,10,13],["Point 10",13,10,15]]

	function scatterPlot (objects, xKey, yKey) {
        if(d3.select("#graph>svg").length > 0) {
        	d3.select("#graph>svg").remove();
        }

        var svg = d3.select("#graph").append("svg")
          .attr("height", scatterHeight).attr("width", scatterWidth);

        var xMax = 0;
        var xMin = 0;
        var yMax = 0;
        var yMin = 0;

        //max and min x and y values
        objects.forEach(function (data) {
        	var xValue = data[xKey];
        	var yValue = data[yKey];

        	if (xValue > xMax) {
        		xMax = xValue*1.05;
        	}
        	// if (xValue < xMin) {
        	// 	xMin = xValue;
        	// }
        	if (yValue > yMax) {
        		yMax = yValue*1.05;
        	}
        	// if (yValue < yMax) {
        	// 	yMin = yValue;
        	// }
        })

        //set up scales
        xScale = d3.scale.linear().domain([0,xMax]).range([scatterPadding, scatterWidth - scatterPadding]);
        yScale = d3.scale.linear().domain([0,yMax]).range([scatterHeight - scatterPadding,scatterPadding]);

        //add axis
        var xAxis = d3.svg.axis().scale(xScale).orient("bottom").ticks(5);
        svg.append("g").attr("class", "axis").attr("transform", "translate(0," + yScale(0) + ")").call(xAxis);

        var yAxis = d3.svg.axis().scale(yScale).orient("left").ticks(5);
        svg.append("g").attr("class", "axis").attr("transform", "translate(" + xScale(0) + ",0)").call(yAxis);

        //add graph and axis titles
        svg.append("text").attr("x",scatterWidth/3).attr("y",25).text("Graph of " + yKey + " vs " + xKey);
        svg.append("text").attr("x",scatterWidth/3).attr("fill","#cccc").attr("y",scatterHeight-10)
          .text(xKey);
        svg.append("text").attr("x",10).attr("fill","#cccc").attr("y",scatterHeight/2-20)
          .text(yKey);

        objects.forEach(function (data) {
         	var pointName = data[0];
         	var xValue = data[xKey];
         	var yValue = data[yKey];
            var pointID = pointName.replace(" ","");
            
            svg.append("circle")
                .attr("cx",xScale(xValue))
                .attr("cy",yScale(yValue))
                .attr("r",5)
                .attr("class", "point")
                .attr("id",  pointID);

            svg.append("text")
                .attr("x",xScale(xValue-xMax*.05))
                .attr("y",yScale(yValue+yMax*.05))
                .attr("class", "pointLabel")
                .attr("id", "label" + pointID)
                .text(pointName);
        });
    }

    scatterPlot(testData,1,2)

    d3.selectAll(".point").on("click", function(point) {
        if (d3.select("#" + this.id).classed("selectedPoint")) {
            replaceClassById(this.id, "selectedPoint","point");
            replaceClassById("label"+this.id,"selectedLabel","pointLabel");
            selectedPoints.splice(selectedPoints.indexOf(this.id),1);
        }

        else {
            if(selectedPoints.length < 3) {
                replaceClassById(this.id, "point","selectedPoint");
                replaceClassById("label"+this.id,"pointLabel","selectedLabel");
                selectedPoints.push(this.id);
            }
            // else {
            //     var removePoint = selectedPoints[0];
            //     replaceClassById(removePoint, "selectedPoint","point");
            //     replaceClassById("label"+removePoint,"selectedLabel","pointLabel");
            //     selectedPoints.splice(0,1);
            //     replaceClassById(this.id, "point","selectedPoint");
            //     replaceClassById("label"+this.id,"pointLabel","selectedLabel");
            //     selectedPoints.push(this.id);
            // }
        }

        // console.log(this);
    });

    function replaceClassById (id, oldClass, newClass) {
        d3.select("#" + id).classed(newClass, true)
        d3.select("#" + id).classed(oldClass, false)
    }

	</script>

</body>
</html>